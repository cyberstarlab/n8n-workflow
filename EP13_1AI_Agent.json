{
  "name": "EP13.AI_Agent",
  "nodes": [
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "claude-3-5-sonnet-20241022",
          "mode": "list",
          "cachedResultName": "Claude Sonnet 3.5 (New)"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        -544,
        96
      ],
      "id": "2290e9b1-a09a-40c4-bd11-d321070dafd4",
      "name": "Anthropic Chat Model",
      "credentials": {
        "anthropicApi": {
          "id": "XSv69t1inh2eehbH",
          "name": "Anthropic account"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -336,
        160
      ],
      "id": "7cd0c95a-a223-44d2-9a52-53b3465a1279",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 14 * * 1-5"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -896,
        272
      ],
      "id": "5925965f-2131-4f37-ab3e-46f113432630",
      "name": "Schedule Trigger"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -448,
        128
      ],
      "id": "2a96ae4f-421d-4528-94df-10b1a85c6cd6",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "P8NijAATf2sliKG4",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        -592,
        -192
      ],
      "id": "d3512528-f02c-4e43-a360-93af9e43a2e0",
      "name": "When chat message received",
      "webhookId": "a3fd9222-0bbc-41dd-9a43-e15b39228155"
    },
    {
      "parameters": {
        "needsFallback": true,
        "options": {
          "systemMessage": "你是一個聰明的AI助手，回覆時請參考以下的注意事項：\n- 除了專業名詞可以使用英文之外，請一律用繁體中文。\n- 使用台灣股市全部上市公司最後的收盤資料時，請將要查詢的上市公司名稱轉換成一個 company_name 的字串陣列傳入。"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -336,
        -192
      ],
      "id": "9dd32490-69c7-4bac-b420-323240bb14a5",
      "name": "AI 小幫手"
    },
    {
      "parameters": {
        "content": "## 工作流名稱:AI Agent 與 Sub workflow。\n### 流程說明: \n   一、透過與 AI 交談，取得上市公司收盤相關資料，並傳送到指定的 Email。\n   二、透過子流程，先過濾自 API 取得的資料，以減少 AI token 的用量。 \n  \n### 詳細內容: \n   一、利用 AI Agent。\n   二、提供 AI 工具用 API 查詢台灣上市公司最近收盤價。\n   三、提供計算機工具供 AI 需要時計算使用。\n   四、提供寄信工具供 AI 需要時寄信使用。\n### 注意事項:\n 1. 使用 API --> 盤後資訊 > 個股日成交資訊\n https://data.gov.tw/dataset/11549\n https://www.twse.com.tw/exchangeReport/STOCK_DAY_ALL?response=open_data\n",
        "height": 364,
        "width": 920,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -944,
        -592
      ],
      "id": "2844a155-9cf5-44c0-bf7c-fdb6d108ac28",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## E13 用到的 Node\n### When chat message received\n## AI Agent\n## Anthropic chat mode\n### OpenAI chat mode\n### Simple Memory\n## Calculator\n## Send mail tool \n## Call n8n workflow tool\n\n# Sub workflow 內\n## Execute subworkflow\n## Http Request\n## Extract from file\n### Filter",
        "height": 564,
        "width": 380,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        112,
        -592
      ],
      "id": "bcfe400f-0327-4476-9855-739d252763f1",
      "name": "Sticky Note1"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "typeVersion": 1,
      "position": [
        -208,
        160
      ],
      "id": "bbfed86a-9c92-44d0-99a8-96cc8618b452",
      "name": "Calculator"
    },
    {
      "parameters": {
        "fromEmail": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('From_Email', ``, 'string') }}",
        "toEmail": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('To_Email', ``, 'string') }}",
        "subject": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Subject', ``, 'string') }}",
        "html": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('HTML', ``, 'string') }}",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.emailSendTool",
      "typeVersion": 2.1,
      "position": [
        -80,
        160
      ],
      "id": "f82e537e-2432-4072-a111-b250ea570682",
      "name": "Send email in Send Email",
      "webhookId": "96b1f380-d07c-4202-aed4-1c541956fb8a",
      "credentials": {
        "smtp": {
          "id": "ue5X0EMig7BvYy2t",
          "name": "SMTPaccount(gmail)"
        }
      }
    },
    {
      "parameters": {
        "description": "台灣股市全部上市公司最後的收盤資料。",
        "workflowId": {
          "__rl": true,
          "value": "9Ap5BeBTe5jTMXWe",
          "mode": "list",
          "cachedResultName": "EP13_sub取得上市收盤數據"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "company_name": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('company_name', ``, 'string') }}"
          },
          "matchingColumns": [
            "company_name"
          ],
          "schema": [
            {
              "id": "company_name",
              "displayName": "company_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "array",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        48,
        128
      ],
      "id": "cd60c06f-d906-4e17-9cb7-ed36412fd5fc",
      "name": "Call n8n Workflow Tool"
    }
  ],
  "pinData": {},
  "connections": {
    "Anthropic Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI 小幫手",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI 小幫手",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        []
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI 小幫手",
            "type": "ai_languageModel",
            "index": 1
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI 小幫手",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calculator": {
      "ai_tool": [
        [
          {
            "node": "AI 小幫手",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Send email in Send Email": {
      "ai_tool": [
        [
          {
            "node": "AI 小幫手",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Call n8n Workflow Tool": {
      "ai_tool": [
        [
          {
            "node": "AI 小幫手",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "ebd14afa-44dd-4987-828d-88a5e042d3c3",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "5319f7ddebad67a3109b936b147dba84cc88bfa9470d2304e4761e96f82a7c70"
  },
  "id": "cwysxMILPul45um9",
  "tags": [
    {
      "createdAt": "2025-04-20T10:59:38.671Z",
      "updatedAt": "2025-04-20T12:13:53.692Z",
      "id": "L8xfvM2kTOCMtEXi",
      "name": "完成"
    },
    {
      "createdAt": "2024-11-28T06:07:07.717Z",
      "updatedAt": "2024-11-28T06:07:07.717Z",
      "id": "p4YCZYdGxbRFEj5A",
      "name": "email"
    },
    {
      "createdAt": "2025-04-15T07:14:49.768Z",
      "updatedAt": "2025-04-15T07:14:49.768Z",
      "id": "saa2PgHXnADVLMWI",
      "name": "學習"
    }
  ]
}